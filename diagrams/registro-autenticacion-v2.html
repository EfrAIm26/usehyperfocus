<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso de Uso - Registro y Autenticaci√≥n | Hyperfocus AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
        }
        
        .download-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }
        
        .diagram-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            animation: fadeInUp 1s ease;
        }
        
        .diagram-title {
            text-align: center;
            font-size: 1.6rem;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }
        
        #diagramCanvas {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            display: block;
        }
        
        .description {
            margin-top: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            border-radius: 10px;
        }
        
        .description h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .description p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 12px;
        }
        
        .actors-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .actor-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }
        
        .actor-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .actor-card p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <button class="download-btn" onclick="downloadDiagram()">üì• Descargar PNG</button>
    
    <div class="header">
        <h1>üìã Caso de Uso - Hyperfocus AI</h1>
        <p>Proceso Cr√≠tico 1: Registro de Nuevo Usuario y Autenticaci√≥n</p>
    </div>
    
    <div class="diagram-container" id="diagramContainer">
        <div class="diagram-title">
            Anexo 1: Caso de uso ‚Äì Registro de Nuevo Usuario y Autenticaci√≥n (Google Auth)
        </div>
        
        <svg id="diagramCanvas" viewBox="0 0 1100 1400" xmlns="http://www.w3.org/2000/svg">
            <!-- Definiciones -->
            <defs>
                <!-- Filtro de sombra -->
                <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                    <feOffset dx="2" dy="2" result="offsetblur"/>
                    <feComponentTransfer>
                        <feFuncA type="linear" slope="0.3"/>
                    </feComponentTransfer>
                    <feMerge>
                        <feMergeNode/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
                
                <!-- Componente de persona reutilizable -->
                <g id="stickFigure">
                    <circle cx="0" cy="-25" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                    <line x1="0" y1="-15" x2="0" y2="10" stroke="currentColor" stroke-width="2"/>
                    <line x1="0" y1="0" x2="-12" y2="15" stroke="currentColor" stroke-width="2"/>
                    <line x1="0" y1="0" x2="12" y2="15" stroke="currentColor" stroke-width="2"/>
                    <line x1="0" y1="10" x2="-10" y2="30" stroke="currentColor" stroke-width="2"/>
                    <line x1="0" y1="10" x2="10" y2="30" stroke="currentColor" stroke-width="2"/>
                </g>
            </defs>
            
            <!-- Actor: Usuario Nuevo (izquierda) -->
            <g transform="translate(80, 100)">
                <use href="#stickFigure" color="#333"/>
                <text x="0" y="50" text-anchor="middle" font-size="14" font-weight="bold">Usuario persona</text>
            </g>
            
            <!-- Rect√°ngulo del Sistema -->
            <rect x="200" y="50" width="700" height="1250" fill="#e8f4f8" stroke="#0066cc" stroke-width="3" rx="10" filter="url(#shadow)"/>
            <text x="550" y="80" text-anchor="middle" font-size="18" font-weight="bold" fill="#0066cc">Aplicaci√≥n Hyperfocus AI</text>
            
            <!-- Casos de Uso (√≥valos) -->
            <!-- Fila 1 -->
            <ellipse cx="500" cy="150" rx="100" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="155" text-anchor="middle" font-size="12">Iniciar sesi√≥n</text>
            
            <!-- Fila 2 -->
            <ellipse cx="400" cy="240" rx="120" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="400" y="240" text-anchor="middle" font-size="11">Visualizar niveles de</text>
            <text x="400" y="252" text-anchor="middle" font-size="11">suscripci√≥n</text>
            
            <!-- Fila 3 - Tres opciones -->
            <ellipse cx="330" cy="340" rx="90" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="330" y="340" text-anchor="middle" font-size="11">Registrar por</text>
            <text x="330" y="352" text-anchor="middle" font-size="11">Google</text>
            
            <ellipse cx="500" cy="340" rx="90" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="345" text-anchor="middle" font-size="11">Confirmar informaci√≥n</text>
            <text x="500" y="357" text-anchor="middle" font-size="11">de registro</text>
            
            <ellipse cx="670" cy="340" rx="90" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="670" y="340" text-anchor="middle" font-size="11">Registrar por</text>
            <text x="670" y="352" text-anchor="middle" font-size="11">Facebook</text>
            
            <!-- Fila 4 -->
            <ellipse cx="500" cy="450" rx="110" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="455" text-anchor="middle" font-size="12">Validar con OAuth 2.0</text>
            
            <!-- Fila 5 -->
            <ellipse cx="500" cy="550" rx="110" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="555" text-anchor="middle" font-size="12">Crear sesi√≥n Supabase</text>
            
            <!-- Fila 6 -->
            <ellipse cx="500" cy="650" rx="100" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="650" text-anchor="middle" font-size="11">Crear registro en</text>
            <text x="500" y="662" text-anchor="middle" font-size="11">auth.users</text>
            
            <!-- Fila 7 -->
            <ellipse cx="500" cy="750" rx="100" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="755" text-anchor="middle" font-size="12">Generar tokens JWT</text>
            
            <!-- Fila 8 -->
            <ellipse cx="500" cy="850" rx="110" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="850" text-anchor="middle" font-size="11">Crear configuraci√≥n</text>
            <text x="500" y="862" text-anchor="middle" font-size="11">inicial (RLS trigger)</text>
            
            <!-- Fila 9 -->
            <ellipse cx="500" cy="950" rx="110" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="950" text-anchor="middle" font-size="11">Almacenar tokens en</text>
            <text x="500" y="962" text-anchor="middle" font-size="11">localStorage</text>
            
            <!-- Fila 10 -->
            <ellipse cx="500" cy="1050" rx="100" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="1050" text-anchor="middle" font-size="11">Renderizar panel</text>
            <text x="500" y="1062" text-anchor="middle" font-size="11">principal</text>
            
            <!-- Fila 11 -->
            <ellipse cx="500" cy="1150" rx="100" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="1150" text-anchor="middle" font-size="11">Visualizar nuevo</text>
            <text x="500" y="1162" text-anchor="middle" font-size="11">chat vac√≠o</text>
            
            <!-- Fila 12 -->
            <ellipse cx="500" cy="1240" rx="90" ry="30" fill="white" stroke="#333" stroke-width="2" filter="url(#shadow)"/>
            <text x="500" y="1245" text-anchor="middle" font-size="12">Confirmaci√≥n final</text>
            
            <!-- Actor: Google (derecha arriba) -->
            <g transform="translate(1000, 350)">
                <use href="#stickFigure" color="#333"/>
                <text x="0" y="50" text-anchor="middle" font-size="13" font-weight="bold">Google</text>
            </g>
            
            <!-- Actor: Supabase Auth (derecha medio) -->
            <g transform="translate(1000, 600)">
                <use href="#stickFigure" color="#333"/>
                <text x="0" y="50" text-anchor="middle" font-size="12" font-weight="bold">Supabase Auth</text>
                <text x="0" y="65" text-anchor="middle" font-size="10">Servicio de</text>
                <text x="0" y="78" text-anchor="middle" font-size="10">Autenticaci√≥n</text>
            </g>
            
            <!-- Actor: Base de datos (derecha abajo) -->
            <g transform="translate(1000, 900)">
                <use href="#stickFigure" color="#333"/>
                <text x="0" y="50" text-anchor="middle" font-size="12" font-weight="bold">Base de datos</text>
                <text x="0" y="65" text-anchor="middle" font-size="10">Unbox[Me]</text>
            </g>
            
            <!-- L√≠neas de conexi√≥n -->
            <!-- Usuario -> Iniciar sesi√≥n -->
            <line x1="80" y1="100" x2="400" y2="150" stroke="#333" stroke-width="2"/>
            
            <!-- Iniciar sesi√≥n -> Visualizar niveles -->
            <line x1="500" y1="180" x2="400" y2="210" stroke="#666" stroke-width="1.5" stroke-dasharray="5,5"/>
            <text x="440" y="195" font-size="10" fill="#666">Include</text>
            
            <!-- Registrar por Google -> Google Auth -->
            <line x1="420" y1="340" x2="950" y2="350" stroke="#333" stroke-width="2"/>
            <text x="680" y="335" font-size="10" fill="#333">OAuth redirect</text>
            
            <!-- Registrar por Facebook -> (no conectado en este ejemplo) -->
            
            <!-- Confirmar informaci√≥n -> Validar OAuth -->
            <line x1="500" y1="370" x2="500" y2="420" stroke="#666" stroke-width="1.5" stroke-dasharray="5,5"/>
            <text x="510" y="395" font-size="10" fill="#666">Include</text>
            
            <!-- Validar OAuth -> Supabase Auth -->
            <line x1="610" y1="450" x2="950" y2="600" stroke="#333" stroke-width="2"/>
            <text x="750" y="520" font-size="10" fill="#333">Valida tokens</text>
            
            <!-- Crear sesi√≥n -> Crear registro -->
            <line x1="500" y1="580" x2="500" y2="620" stroke="#666" stroke-width="1.5" stroke-dasharray="5,5"/>
            <text x="510" y="600" font-size="10" fill="#666">Include</text>
            
            <!-- Crear registro -> Base de datos -->
            <line x1="600" y1="650" x2="950" y2="900" stroke="#333" stroke-width="2"/>
            <text x="750" y="770" font-size="10" fill="#333">INSERT user</text>
            
            <!-- Generar tokens -> Almacenar -->
            <line x1="500" y1="780" x2="500" y2="920" stroke="#666" stroke-width="1.5" stroke-dasharray="5,5"/>
            <text x="510" y="850" font-size="10" fill="#666">Include</text>
            
            <!-- Renderizar panel -> Visualizar chat -->
            <line x1="500" y1="1080" x2="500" y2="1120" stroke="#666" stroke-width="1.5" stroke-dasharray="5,5"/>
            <text x="510" y="1100" font-size="10" fill="#666">Include</text>
            
            <!-- Confirmaci√≥n final -> Usuario -->
            <line x1="410" y1="1240" x2="80" y2="130" stroke="#333" stroke-width="2"/>
            <text x="200" y="680" font-size="11" fill="#333" transform="rotate(-70, 200, 680)">‚úì Usuario autenticado</text>
        </svg>
        
        <div class="description">
            <h3>üìù Descripci√≥n del Proceso</h3>
            <p><strong>Objetivo:</strong> Permitir que un nuevo usuario se registre y autentique en Hyperfocus AI utilizando su cuenta de Google, garantizando un proceso sin fricci√≥n y t√©cnicamente robusto.</p>
            
            <p><strong>Flujo de Experiencia:</strong> El usuario accede a la aplicaci√≥n, visualiza un bot√≥n "Sign in with Google", es redirigido al flujo OAuth 2.0 de Google, autoriza los permisos, y es redirigido autom√°ticamente a su panel principal con un chat nuevo listo para usar.</p>
            
            <p><strong>Resultado:</strong> Usuario autenticado con sesi√≥n persistente, registro creado en la base de datos, y configuraci√≥n inicial establecida (Focus Mode: default, Font Style: normal, Semantic Chunking: false).</p>
        </div>
        
        <div class="actors-legend">
            <div class="actor-card">
                <h4>üë§ Usuario Persona</h4>
                <p>Persona que accede por primera vez a Hyperfocus AI y desea crear una cuenta para utilizar el asistente de IA especializado en neurodivergencia.</p>
            </div>
            
            <div class="actor-card">
                <h4>üîê Google</h4>
                <p>Proveedor de identidad OAuth 2.0 que valida las credenciales del usuario, verifica el consentimiento de permisos (email y perfil), y genera c√≥digos de autorizaci√≥n.</p>
            </div>
            
            <div class="actor-card">
                <h4>üîí Supabase Auth</h4>
                <p>Servicio de autenticaci√≥n que act√∫a como intermediario entre la aplicaci√≥n y Google Auth, intercambia c√≥digos OAuth por tokens JWT, y gestiona las sesiones de usuario.</p>
            </div>
            
            <div class="actor-card">
                <h4>üíæ Base de datos Unbox[Me]</h4>
                <p>Base de datos PostgreSQL (Supabase) que almacena los registros de usuarios (auth.users), configuraciones (user_settings), y aplica pol√≠ticas de Row Level Security (RLS) para proteger los datos.</p>
            </div>
            
            <div class="actor-card">
                <h4>üöÄ Vercel</h4>
                <p>Plataforma de deployment que sirve el frontend React de la aplicaci√≥n mediante SSR y CDN global, garantizando velocidad y disponibilidad.</p>
            </div>
        </div>
    </div>
    
    <script>
        function downloadDiagram() {
            const container = document.getElementById('diagramContainer');
            
            // Mostrar mensaje de carga
            const btn = document.querySelector('.download-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Generando...';
            btn.disabled = true;
            
            html2canvas(container, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                // Crear enlace de descarga
                const link = document.createElement('a');
                link.download = 'caso-uso-registro-autenticacion-hyperfocus-ai.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // Restaurar bot√≥n
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                // Mensaje de √©xito
                btn.innerHTML = '‚úÖ ¬°Descargado!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            }).catch(error => {
                console.error('Error al generar imagen:', error);
                btn.innerHTML = '‚ùå Error';
                btn.disabled = false;
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }
    </script>
</body>
</html>





